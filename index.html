<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no"
  />
  <title>사이클 아카데미 - 워크아웃 앱</title>

  <!-- 깔끔 분리된 CSS -->
  <link rel="stylesheet" href="assets/css/style.css" />

  <!-- PWA/모바일 최적화(선택) -->
  <meta name="theme-color" content="#2E74E8" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />

  <!-- GitHub Pages에서 HTTPS 필요 안내용 (JS에서 실제 체크) -->
  <noscript>이 앱은 자바스크립트가 필요합니다.</noscript>
</head>
<body>
  <!-- 연결 화면 -->
  <section id="connectionScreen" class="screen active">
    <header class="header">
      <h1>🚴‍♂️ 사이클 아카데미</h1>
      <p class="subtitle">스마트로라 / 파워미터 / 심박계를 연결하세요(1032)</p>
    </header>

    <div class="card">
      <h3 class="card-title">📡 블루투스 기기 연결</h3>
      <div class="grid-2 gap-10 mb-15">
        <button class="btn" id="btnConnectTrainer">스마트 트레이너</button>
        <button class="btn btn-secondary" id="btnConnectHeart">심박계 연결</button>
        <button class="btn" id="btnConnectPower">파워미터 연결</button>
      </div>
    </div>

    <div id="deviceList"></div>

    <div id="connectionStatus" class="hidden">
      <div class="card text-center">
        <div class="loading">
          <div class="spinner"></div>
          <p>기기에 연결 중...</p>
        </div>
      </div>
    </div>

    <div id="connectedDevicesSummary" class="card hidden">
      <h3 class="mb-15">✅ 연결된 기기</h3>
      <div id="connectedDevicesList"></div>
      <button class="btn btn-success mt-15" id="btnProceedToProfile">다음 단계로</button>
    </div>
  </section>

  <!-- 프로필 선택 화면 -->
  <section id="profileScreen" class="screen">
    <header class="header">
      <h1>👤 프로필 선택</h1>
      <p class="subtitle">훈련할 사용자를 선택하세요</p>
    </header>

    <div id="profileList"></div>

    <div class="card pointer" id="cardShowAddUser">
      <div class="text-center">
        <div class="big-plus">➕</div>
        <h3>새 사용자 추가</h3>
        <p class="muted mt-5">FTP와 몸무게를 입력하여 새 프로필을 만드세요</p>
      </div>
    </div>

    <div id="addUserForm" class="card hidden">
      <h3 class="mb-20">새 사용자 등록</h3>

      <div class="form-group">
        <label for="userName">이름</label>
        <input type="text" id="userName" placeholder="이름을 입력하세요" />
      </div>

      <div class="form-group">
        <label for="userContact">연락처</label>
        <input type="tel" id="userContact" placeholder="010-1234-5678" />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="userFTP">FTP (W)</label>
          <input type="number" id="userFTP" placeholder="250" min="100" max="500" />
        </div>
        <div class="form-group">
          <label for="userWeight">몸무게 (kg)</label>
          <input type="number" id="userWeight" placeholder="70" min="40" max="150" />
        </div>
      </div>

      <div class="row gap-10 mt-10">
        <button class="btn btn-success" id="btnSaveNewUser">저장</button>
        <button class="btn btn-secondary" id="btnCancelAddUser">취소</button>
      </div>
    </div>
  </section>

  <!-- 워크아웃 선택 화면 -->
  <section id="workoutScreen" class="screen">
    <header class="header">
      <h1>📋 워크아웃 선택</h1>
      <p class="subtitle">오늘의 훈련 프로그램을 선택하세요</p>
    </header>

    <div id="workoutList"></div>
  </section>

  <!-- 훈련 준비 화면 -->
  <section id="trainingReadyScreen" class="screen">
    <header class="header">
      <h1>🎯 훈련 준비</h1>
      <p class="subtitle">선택한 워크아웃을 확인하고 시작하세요</p>
    </header>

    <div class="workout-preview card">
      <h2 id="previewWorkoutName">SST_MCT(14)</h2>
      <div class="preview-summary">
        <div>
          <strong id="previewDuration">92분</strong>
          <br /><span class="muted">총 시간</span>
        </div>
        <div>
          <strong id="previewIntensity">78%</strong>
          <br /><span class="muted">평균 강도</span>
        </div>
        <div>
          <strong id="previewTSS">82</strong>
          <br /><span class="muted">예상 TSS</span>
        </div>
      </div>

      <div class="segment-preview" id="segmentPreview"></div>
    </div>

    <div class="training-ready text-center">
      <div class="mb-30">
        <h3 class="mb-15">훈련 준비 완료</h3>
        <p class="muted">
          시작 버튼을 누르면 5초 카운트다운 후 훈련이 시작됩니다.
        </p>
      </div>

      <div class="row gap-15 center">
        <button class="btn btn-success min-150" id="btnStartTraining">🚀 훈련 시작</button>
        <button class="btn btn-secondary min-150" id="btnBackWorkouts">← 워크아웃 변경</button>
      </div>
    </div>
  </section>

  <!-- 훈련 화면 -->
  <section id="trainingScreen" class="screen">
    <div class="training-header">
      <div id="userInfo" class="user-badge">
        <!-- 사용자 정보 -->
      </div>
      <div class="segment-details">
        <span class="elapsed-block">
          <span id="elapsedTime">00:00</span>
          <span class="metric-label">경과 시간</span>
        </span>
        <span id="segmentTime" class="segment-time">00:00</span>
        <span id="nextSegment" class="next-segment">다음: 인터벌 FTP 140%</span>
      </div>
    </div>

    <div class="metrics-grid">
      <!-- 좌측 카드: 랩 파워 + TSS -->
      <div class="metric-card avg-segment-power">
        <div class="col-center">
          <div class="metric-value" id="avgSegmentPowerValue">178</div>
          <div class="metric-label">랩 파워 (W)</div>
          <div class="metric-value big" id="tssValue">0</div>
          <div class="metric-label">TSS</div>
        </div>
      </div>

      <!-- 중앙: 현재 파워 + 바 + 타겟 + 세그먼트명 -->
      <div class="power-display">
        <div class="current-power" id="currentPowerValue">185</div>
        <div class="muted">WATTS</div>

        <div class="power-progress">
          <div class="power-progress-bar" id="powerProgressBar"></div>
          <div class="power-progress-label">
            달성도: <span id="achievementValueBar">0</span>%
          </div>
        </div>

        <div class="text-center mt-10">
          <div id="powerComparison" class="metric-value">
            <span class="metric-label">목표 :</span>
            <span id="targetPowerValue">194</span>
            <span class="metric-label">W</span>
          </div>

          <div id="segmentProgressText" class="segment-progress">
            진행률 <span id="segmentProgress">0</span>%
          </div>

          <div id="currentSegmentName" class="current-segment-name">
            웜업 - 80RPM FTP 60%
          </div>
        </div>
      </div>

      <!-- 우측: 심박/케이던스/칼로리 -->
      <div class="metric-card dual-metric">
        <div class="metric-item">
          <div class="metric-value" id="heartRateValue">145</div>
          <div class="metric-label">BPM</div>
        </div>
        <div class="metric-item">
          <div class="metric-value" id="cadenceValue">89</div>
          <div class="metric-label">RPM</div>
        </div>
        <div class="metric-item">
          <div class="metric-value" id="calorieValue">-</div>
          <div class="metric-label">kcal</div>
        </div>
      </div>
    </div>

    <div class="timeline cardish">
      <div class="timeline-progress">
        <div class="timeline-segments" id="timelineSegments"></div>
      </div>
      <div class="timeline-bottom muted">
        <span>진행률: <span id="elapsedPercent">0</span>%</span>
        <span>평균 파워: <span id="avgPowerValue">178</span>W</span>
      </div>
    </div>

    <div class="training-controls">
      <button class="control-btn pause" id="btnPauseResume" title="일시정지/재개">
        <span id="pauseIcon">⏸️</span>
      </button>
      <button class="control-btn" id="btnSkipSegment" title="구간 건너뛰기">⏭️</button>
      <button class="control-btn stop" id="btnStopTraining" title="훈련 종료">⏹️</button>
    </div>
  </section>

  <!-- 결과 화면 -->
  <section id="resultScreen" class="screen">
    <header class="header">
      <h1>🎉 훈련 완료!</h1>
      <p class="subtitle">수고하셨습니다</p>
    </header>

    <div class="text-center mb-30">
      <div class="achievement-circle">
        <div class="achievement-text" id="finalAchievement">89%</div>
      </div>
      <h2 id="workoutCompletedName">SST_MCT(14) - 92분 완주</h2>
    </div>

    <div class="result-stats">
      <div class="result-stat">
        <div class="result-stat-value" id="resultAvgPower">184</div>
        <div class="result-stat-label">평균 파워 (W)</div>
      </div>
      <div class="result-stat">
        <div class="result-stat-value" id="resultMaxPower">285</div>
        <div class="result-stat-label">최대 파워 (W)</div>
      </div>
      <div class="result-stat">
        <div class="result-stat-value" id="resultAvgHR">152</div>
        <div class="result-stat-label">평균 심박 (BPM)</div>
      </div>
      <div class="result-stat">
        <div class="result-stat-value" id="resultCalories">892</div>
        <div class="result-stat-label">칼로리 (kcal)</div>
      </div>
    </div>

    <div class="card">
      <h3 class="mb-15">🤖 AI 성과 분석</h3>
      <div id="aiAnalysis" class="ai-analysis">분석 중...</div>
    </div>

    <div class="row gap-10 mt-20">
      <button class="btn btn-success" id="btnSaveResult">저장하기</button>
      <button class="btn btn-secondary" id="btnShareResult">공유하기</button>
    </div>

    <button class="btn mt-10" id="btnNewTraining">새 훈련 시작</button>
  </section>

  <!-- 카운트다운 오버레이 -->
  <div id="countdownOverlay" class="countdown-overlay hidden" aria-hidden="true">
    <div class="countdown-number" id="countdownNumber">5</div>
    <!-- 메시지는 JS가 동적으로 추가 -->
  </div>

  <!-- JS 분리 로드: 데이터 → BLE → 앱 로직 (의존 순서) -->
  <script defer src="assets/js/data.js"></script>
  <script defer src="assets/js/bluetooth.js"></script>
  <script defer src="assets/js/app.js"></script>
</body>
</html>
